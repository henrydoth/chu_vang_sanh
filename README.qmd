---
title: "README"
author: "henry"
format: html
editor: visual
execute:
  echo: true
  warning: false
  message: false
---

```{r}
#| label: setup
#| include: false

# 1) Bảo đảm here dùng đúng root project
# (Bạn đang có .Rproj nên here::here() tự đúng)

# 2) Hàm đọc 12 dòng Chú Đại Bi (random 12 dòng liên tiếp)
db12 <- function(time = 0) {
  x <- readLines(here::here("md_files", "chu_dai_bi.md"))
  x <- x[nzchar(trimws(x))]

  k <- 12
  n <- length(x)
  if (n < k) stop("File chu_dai_bi.md không đủ 12 dòng.")
  i <- sample.int(n - k + 1, 1)
  doan <- x[i:(i + k - 1)]

  for (j in seq_along(doan)) {
    cat(doan[j], "\n", sep = "")
    if (time > 0) Sys.sleep(time)
  }

  invisible(NULL)
}

# 3) Hàm 12 dòng Lăng Nghiêm (giữ code bạn chốt)
ln12 <- function(n12 = NULL, n3 = 0, n4 = 0, time = 1) {
  x <- readLines(here::here("md_files", "lang_nghiem.md"))
  x <- x[nzchar(trimws(x))]

  k <- 12
  N <- length(x)
  if (N < k) stop("File không đủ 12 dòng.")

  max_n12 <- floor((N - k) / k)

  # nếu không truyền n12 → random 1 block
  if (is.null(n12)) n12 <- sample.int(max_n12 + 1, 1) - 1
  n12 <- n12 %% (max_n12 + 1)

  # màu chữ chính: 3 dòng / 1 màu
  mau_dong <- c("\033[31m", "\033[34m", "\033[37m", "\033[33m")

  # màu chữ Hoa sau '#': 3 dòng / 1 màu
  mau_hash <- c("\033[37m", "\033[33m", "\033[31m", "\033[34m")

  mau_xam <- "\033[90m"  # xám cho dấu #
  reset   <- "\033[0m"

  for (b in seq_along(n12)) {
    i0 <- 12 * n12[b] + 1
    doan <- x[i0:(i0 + k - 1)]

    for (i in seq_along(doan)) {
      block3 <- ((i - 1 + n3 * 3) %/% 3)
      m_dong <- mau_dong[block3 %% 4 + 1]
      m_hash <- mau_hash[(block3 + n4) %% 4 + 1]

      line <- doan[i]

      if (grepl("#", line, fixed = TRUE)) {
        parts <- strsplit(line, "#", fixed = TRUE)[[1]]
        left  <- trimws(parts[1], "right")
        right <- trimws(paste(parts[-1], collapse = "#"), "left")

        cat(
          m_dong, left, reset,
          " ", mau_xam, "#", reset, " ",
          m_hash, right, reset,
          "\n",
          sep = ""
        )
      } else {
        cat(m_dong, line, reset, "\n", sep = "")
      }

      Sys.sleep(time)   # nhịp tụng mỗi dòng
    }

    if (length(n12) > 1 && b < length(n12)) {
      cat("\n")
      Sys.sleep(time)
    }
  }

  invisible(NULL)
}
```